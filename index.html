<!DOCTYPE html>
<!-- This HTML source code is placed in the public domain -->
<html manifest="manifest">
 <head>
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style"
    content="black-translucent" />
  <link rel="apple-touch-icon-precomposed" href="data:image/png;base64,
  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" />
  <style type="text/css">
body {
    font-size: 300%;
    font-family: sans-serif;
    text-align: center;
}
#ui {
    margin-top: 40px;
}
#average {
    font-size: 200%;
}
select {
    -webkit-appearance: none;
    font-size: inherit;
    color: #08c;
}
#weight {
    margin-top: .5em;
}
#history {
    font-size: 50%;
    margin-top: .5em;
}
#log {
    font-family: monospace;
    font-size: 30%;
    opacity: 0;
    text-align: left;
    min-height: 80px;
}
  </style>
  <title>Weight</title>
 </head>
 <body>
  <div id="ui">
   <div id="average">
   </div>
   <div>
    <select id="day"></select>
   </div>
   <div>
    <select id="weight"></select>
   </div>
   <div id="history">
   </div>
   <div id="log">
   </div>
  </div>
  <script type="text/javascript">
(function () {
'use strict';
var qs = function (q) {return document.querySelector(q);},
    qsa = function (q) {
        return Array.prototype.slice.call(document.querySelectorAll(q));
    },
    scrollUp = function () {
        document.body.scrollTop = document.documentElement.scrollTop = 0;
    },
    log,
    MAX_WEIGHT = 100,
    MIN_WEIGHT = 50,
    NDAYS = 4,
    minPerDay = 24 * 60,
    DAYS = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday',
            'Saturday'],
    theDays,
    weightToString,
    onWeightChange,
    onDayChange,
    day,
    onNewDay,
    state,
    current = 0;

log = (function () {
    var logContents = "",
        isLogVisible = function () {
            return qs('#log').style.opacity === '1';
        },
        toggleVisibility = function (e) {
            var wasVisible = isLogVisible();
            e.style.opacity  = wasVisible ? '' : '1';
            qs('#log').innerHTML = wasVisible ? '' : logContents;
        };

    qs('#log').addEventListener('dblclick', function () {
        toggleVisibility(this);
    }, false);
    qs('#log').addEventListener('gesturestart', function () {
        toggleVisibility(this);
    }, false);

    return function (m) {
        logContents = '<hr>' + m + logContents;
        if (isLogVisible()) {
            qs('#log').innerHTML = logContents;
        };
    };
}());

theDays = function () {
    var today = new Date().getDay(),
        result = ['Today', 'Yesterday'],
        i = 1, 
        d;
    while (++i < state.weights.length) {
        d = today - i;
        while (d >= DAYS.length) {
            d -= DAYS.length;
        }
        while (d < 0) {
            d += DAYS.length;
        }
        result.push(DAYS[d]);
    }
    return result.slice(0, state.weights.length);
}

weightToString = function (w) {
    w = String(Math.floor(w * 10 + 0.5));
    while (w.length < 3) {
        w = ' ' + w;
    }
    return w.substr(0, w.length - 1) + '.' + w.substr(w.length - 1, 1);
};

onWeightChange = function () {
    var av,
        i;

    state.weights[current] = parseFloat(qs('#weight').value);
    localStorage.state = JSON.stringify(state);
    av = 0;
    for (i = 0; i < state.weights.length; i++) {
        av += state.weights[i];
    }
    av /= state.weights.length;
    qs('#average').innerHTML = weightToString(av);
    qs('#history').innerHTML = state.weights.join(' ');
    log(current + ' ' + av + ' ' + localStorage.state);
};

onDayChange = function () {
    current = qs('#day').selectedIndex;
    qs('#weight').value = weightToString(state.weights[current]);

    log(current + ' ' + theDays()[current] + ' ' + qs('#weight').value);
};

onNewDay = function () {
    var date = new Date(),
        today = Math.floor(
                (date.getTime() / 1000 / 60 - date.getTimezoneOffset()) /
                        minPerDay),
        untilTomorrow,
        weight;
    log(current + ' ' + today);

    if (!state) {
        state = localStorage.state;
        if (state) {
            state = JSON.parse(state);
        }
    }
    if (!state || !state.day || state.day > today ||
            state.day + NDAYS < today) {
        if (state && state.weights && state.weights.length > 0) {
            weight = state.weights[0];
        }
        else {
            weight = (MAX_WEIGHT + MIN_WEIGHT) / 2;
        }
        state = {day: today, weights: [weight]};
        current = 0;
    }

    while (state.day < today) {
        state.weights.unshift(state.weights[0]);
        if (state.weights.length > NDAYS) {
            state.weights.pop();
        }
        state.day++;
        current++;
    }

    qs('#day').innerHTML =
        '<option>' + theDays().join('</option><option>') + '</option>';
    if (current >= NDAYS) {
        current = 0;
    }
    qs('#day').selectedIndex = current;
    onDayChange();
    onWeightChange();
    untilTomorrow = ((today + 1) * minPerDay +
            date.getTimezoneOffset()) * 60 * 1000 - date.getTime();
    log('waiting... ' + untilTomorrow);
    setTimeout(onNewDay, untilTomorrow);
};

(function () {
    var list,
        i,
        selectors = qsa('select');
    list = [];
    for (i = MIN_WEIGHT * 10; i < MAX_WEIGHT * 10; i++) {
        list.push(weightToString(i / 10));
    }
    qs('#weight').innerHTML =
        '<option>' + list.join('</option><option>') + '</option>';
    qs('#weight').addEventListener('change', onWeightChange, false);

    qs('#day').addEventListener('change', onDayChange, false);

    for (i = 0; i < selectors.length; i++) {
        selectors[i].addEventListener('focusout', scrollUp, false);
    }

    onNewDay();
}());

}());
  </script>
 </body>
</html>
